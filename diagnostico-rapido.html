<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico R√°pido - Cat√°logo FYL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        button {
            background: #CD844D;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #b8733a; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico R√°pido - Cat√°logo FYL</h1>
    
    <div class="test-container">
        <h2>üìã Estado del Sistema</h2>
        <button onclick="ejecutarDiagnostico()">Ejecutar Diagn√≥stico</button>
        <div id="resultado">Haz clic en "Ejecutar Diagn√≥stico"</div>
    </div>

    <div class="test-container">
        <h2>üîó Enlaces de Prueba</h2>
        <p><a href="index.html" target="_blank">üì± Cat√°logo Principal</a></p>
        <p><a href="verificar-supabase.html" target="_blank">üóÑÔ∏è Verificaci√≥n Supabase</a></p>
        <p><a href="test-supabase.html" target="_blank">üß™ Test Supabase</a></p>
    </div>

    <script type="module">
        // Funci√≥n de diagn√≥stico
        window.ejecutarDiagnostico = async function() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p class="info">üîÑ Ejecutando diagn√≥stico...</p>';

            let reporte = [];
            reporte.push('üîç DIAGN√ìSTICO R√ÅPIDO - CAT√ÅLOGO FYL');
            reporte.push('=====================================');

            // 1. Verificar configuraci√≥n
            reporte.push('\n1. üìã CONFIGURACI√ìN:');
            try {
                const config = await import('./scripts/config.local.js');
                reporte.push(`‚úÖ SUPABASE_URL: ${config.SUPABASE_URL}`);
                reporte.push(`‚úÖ SUPABASE_ANON_KEY: ${config.SUPABASE_ANON_KEY ? 'Configurada' : 'No configurada'}`);
                reporte.push(`‚úÖ USE_SUPABASE: ${config.USE_SUPABASE}`);
                reporte.push(`‚úÖ USE_OPEN_SHEET_FALLBACK: ${config.USE_OPEN_SHEET_FALLBACK}`);
            } catch (e) {
                reporte.push(`‚ùå Error cargando configuraci√≥n: ${e.message}`);
            }

            // 2. Verificar Supabase
            reporte.push('\n2. üóÑÔ∏è SUPABASE:');
            try {
                const { createClient } = await import('https://cdn.skypack.dev/@supabase/supabase-js@2');
                const config = await import('./scripts/config.local.js');
                const supabase = createClient(config.SUPABASE_URL, config.SUPABASE_ANON_KEY);
                
                // Probar conexi√≥n
                const { data, error } = await supabase
                    .from('catalog_public_view')
                    .select('*')
                    .limit(1);

                if (error) {
                    reporte.push(`‚ùå Error de conexi√≥n: ${error.message}`);
                } else {
                    reporte.push(`‚úÖ Conexi√≥n exitosa`);
                    reporte.push(`‚úÖ Vista catalog_public_view accesible`);
                    reporte.push(`‚úÖ Productos encontrados: ${data.length}`);
                }
            } catch (e) {
                reporte.push(`‚ùå Error inicializando Supabase: ${e.message}`);
            }

            // 3. Verificar scripts
            reporte.push('\n3. üîß SCRIPTS:');
            const scripts = [
                'scripts/config.js',
                'scripts/supabase-client.js',
                'scripts/main-supabase.js',
                'scripts/cart-persistent.js'
            ];

            for (const script of scripts) {
                try {
                    await import(`./${script}`);
                    reporte.push(`‚úÖ ${script}: Cargado correctamente`);
                } catch (e) {
                    reporte.push(`‚ùå ${script}: Error - ${e.message}`);
                }
            }

            // 4. Verificar elementos del DOM
            reporte.push('\n4. üéØ ELEMENTOS DOM:');
            const elementos = [
                'catalogo',
                'loader',
                'categoria-actual',
                'filtros'
            ];

            for (const elemento of elementos) {
                const el = document.getElementById(elemento);
                if (el) {
                    reporte.push(`‚úÖ #${elemento}: Encontrado`);
                } else {
                    reporte.push(`‚ùå #${elemento}: No encontrado`);
                }
            }

            // 5. Verificar funciones globales
            reporte.push('\n5. üåê FUNCIONES GLOBALES:');
            const funciones = [
                'cargarCategoria',
                'cambiarCategoria',
                'downloadImage',
                'compartirImagen'
            ];

            for (const funcion of funciones) {
                if (typeof window[funcion] === 'function') {
                    reporte.push(`‚úÖ ${funcion}(): Disponible`);
                } else {
                    reporte.push(`‚ùå ${funcion}(): No disponible`);
                }
            }

            reporte.push('\n=====================================');
            reporte.push('üîç DIAGN√ìSTICO COMPLETADO');

            resultado.innerHTML = `
                <p class="success">‚úÖ Diagn√≥stico completado</p>
                <details>
                    <summary>Ver reporte completo</summary>
                    <pre>${reporte.join('\n')}</pre>
                </details>
            `;
        };

        // Ejecutar diagn√≥stico autom√°ticamente al cargar
        window.addEventListener('load', () => {
            setTimeout(ejecutarDiagnostico, 1000);
        });
    </script>
</body>
</html>

