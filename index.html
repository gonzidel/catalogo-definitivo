<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cat√°logo FYL</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="icons/icon-192x192.png" type="image/png">
  <meta name="theme-color" content="#CD844D">
  <style>
    header { position: relative; }
    .cliente-link { 
      position: absolute; 
      right: 16px; 
      top: 16px; 
      padding: 8px 12px; 
      border: 1px solid #ddd; 
      border-radius: 8px; 
      text-decoration: none; 
      color: #333; 
      background: #fff; 
      font-family: Poppins, system-ui, sans-serif; 
      font-size: 14px; 
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .cliente-link:hover { 
      background: #f7f7f7; 
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .cliente-link img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #CD844D;
      transition: transform 0.2s ease;
    }
      .cliente-link:hover img {
        transform: scale(1.05);
      }
      
      /* Asegurar que el dropdown solo aparezca en click, no en hover */
      .cliente-link:hover .user-dropdown {
        display: none !important;
      }
    
    /* Estilos para el dropdown del usuario */
    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      min-width: 200px;
      animation: dropdownFadeIn 0.2s ease;
    }
    
    @keyframes dropdownFadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .user-dropdown a:hover,
    .user-dropdown button:hover {
      background: #f8f9fa !important;
    }
      
      /* Estilos para el bot√≥n del carrito */
      .cart-button {
        background: #CD844D !important;
        color: white !important;
        border: none !important;
        padding: 8px 16px !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-weight: bold !important;
        transition: all 0.2s ease !important;
        display: flex !important;
        align-items: center !important;
        gap: 6px !important;
        font-size: 14px !important;
      }
      
      .cart-button:hover {
        background: #B8734A !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
      }
      
      .cart-button:active {
        transform: translateY(0) !important;
      }
      
      .cart-button strong {
        color: #fff !important;
        font-size: 16px !important;
      }
      
      /* Animaci√≥n para el bot√≥n del carrito */
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-3px); }
        60% { transform: translateY(-2px); }
      }
      
      .cart-button.animate {
        animation: bounce 0.6s ease-in-out;
      }

    /* Modal de login */
    body.modal-open {
      overflow: hidden;
    }
    #login-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(6px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      padding: 20px;
    }
    #login-modal.active {
      display: flex;
    }
    .login-modal-card {
      width: min(420px, 100%);
      background: #fff;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
      position: relative;
      text-align: center;
      font-family: Poppins, system-ui, sans-serif;
      animation: modalFadeIn 0.25s ease;
    }
    .login-modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 20px;
      color: #888;
      cursor: pointer;
    }
    .login-modal-close:hover {
      color: #444;
    }
    .login-modal-card h2 {
      margin: 12px 0 8px;
      color: #333;
    }
    .login-modal-card p {
      color: #666;
      font-size: 14px;
      margin-bottom: 24px;
    }
    .login-modal-google {
      width: 100%;
      padding: 12px 20px;
      background: #4285f4;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .login-modal-google:hover:not([disabled]) {
      background: #3367d6;
    }
    .login-modal-google[disabled] {
      background: #9cbaf9;
      cursor: not-allowed;
    }
    .login-modal-msg {
      margin-top: 18px;
      font-size: 14px;
      color: #c0392b;
      display: none;
    }
    .login-modal-msg.visible {
      display: block;
    }
    @keyframes modalFadeIn {
      from {
        transform: translateY(15px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    </style>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2JDYZW1KD6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2JDYZW1KD6');
  </script>
</head>
<body>
  <header>
    <a class="cliente-link" href="#" onclick="return false;">√Årea de Clientes</a>
    <img src="logo.png" alt="Logo F&L"/>
    <h1>Cat√°logo FYL</h1>
  </header>

  <div class="container">
    <div class="menu">
      <button onclick="window.cambiarCategoria('Calzado')">Calzado</button>
      <button onclick="window.cambiarCategoria('Ropa')">Ropa</button>
      <button onclick="window.cambiarCategoria('Lenceria')">Lencer√≠a</button>
      <button onclick="window.cambiarCategoria('Marroquineria')">Accesorios</button>
      <button onclick="window.cambiarCategoria('Novedades')" id="btn-novedades">Novedades ‚≠ê</button>
      <button onclick="window.cambiarCategoria('Ofertas')">Ofertas üî•</button>
    </div>

  <div class="filter-search-view" id="filter-container">
      <button id="toggleFiltros">Filtros</button>
      <div id="filtroMenu" style="display:none"></div>
      <input type="text" id="searchInput" placeholder="Buscar art√≠culo...">
      <input type="text" id="search-input" placeholder="Buscar art√≠culo..." style="display:none;">
      <button id="clear-search" title="Limpiar b√∫squeda">Limpiar</button>
      <button id="view-toggle">üî≥ Normal</button>
      <div id="cart-bar" style="margin-left:auto;display:flex;gap:8px;align-items:center;">
        <button id="cart-button" class="cart-button" style="display:none;background:#CD844D;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:bold;transition:all 0.2s ease;">
          <span>üõí Pedido: <strong id="cart-count">0</strong> √≠tems</span>
        </button>
        <button id="cart-submit" title="Enviar pedido" style="display:none;">Enviar pedido</button>
      </div>
    </div>

    <div id="loader" class="loader">
      <div class="spinner"></div>
    </div>

    <div id="catalogo" class="catalogo">
      <div id="catalog-container"></div>
    </div>
  </div>

  <!-- WhatsApp popup -->
  <div id="wa-popup">
    <button id="wa-toggle" title="Chat WhatsApp">
      <img src="./icons/whatsapp.svg" alt="WhatsApp" />
    </button>
    <div id="wa-menu">
      <a href="https://wa.me/5493625172874" target="_blank">Ani</a>
      <a href="https://wa.me/5493624866768" target="_blank">Fati</a>
      <a href="https://wa.me/5493624118637" target="_blank">Local</a> 
    </div>
  </div>

  <!-- Bot√≥n scroll hacia arriba -->
  <button id="btn-scroll-top" title="Volver arriba" aria-label="Volver arriba">
    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
      <path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.59 5.58L20 12l-8-8-8 8z"/>
    </svg>
  </button>

  <!-- Modal de login - Paso 1: Email -->
  <div id="login-modal">
    <div class="login-modal-card">
      <button id="login-modal-close" class="login-modal-close" aria-label="Cerrar">√ó</button>
      <img src="logo.png" alt="Logo FYL" style="height: 64px; margin-bottom: 12px;">
      
      <!-- Paso 1: Opciones de login unificadas -->
      <div id="login-step-1">
        <h2>¬øCu√°l es tu email?</h2>
        <p style="color: #666; font-size: 14px; margin-bottom: 24px;">Reg√≠strate o inici√° sesi√≥n para hacer tu pedido</p>
        
        <!-- Bot√≥n de Google OAuth -->
        <button id="login-google-btn-step1" class="login-modal-google" style="margin-bottom: 16px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 533.5 544.3" aria-hidden="true">
            <path fill="#4285f4" d="M533.5 278.4c0-17.4-1.5-34.1-4.3-50.3H272.1v95.1h147.1c-6.3 34-25 62.8-53.3 82l86.1 66.9c50.3-46.4 81.5-114.8 81.5-193.7z"/>
            <path fill="#34a853" d="M272.1 544.3c72.8 0 134-24 178.7-65.3l-86.1-66.9c-24 16.1-54.8 25.7-92.6 25.7-71.2 0-131.7-48.1-153.3-112.8l-89 68.7c44.4 88 135.4 150.6 242.3 150.6z"/>
            <path fill="#fbbc04" d="M118.8 324.9c-10.7-31.9-10.7-66.3 0-98.2l-89-68.7c-39.2 78.6-39.2 171.7 0 250.3l89-68.7z"/>
            <path fill="#ea4335" d="M272.1 107.7c39.6 0 75.2 13.6 103.3 40.3l77.4-77.4C406.1 24.4 344.9 0 272.1 0 165.2 0 74.2 62.6 29.8 150.6l89 68.7c21.6-64.7 82.1-111.6 153.3-111.6z"/>
          </svg>
          Continuar con Gmail
        </button>
        
        <div style="margin: 20px 0; text-align: center; color: #666; font-size: 14px;">
          <span>O</span>
        </div>
        
        <input 
          type="email" 
          id="login-email-input" 
          placeholder="tu@email.com"
          style="width: 100%; padding: 14px; margin-bottom: 16px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;"
          autocomplete="email"
        />
        <button id="login-continue-btn" class="login-modal-google" style="background: #4285f4;">
          Enviarme un enlace de inicio de sesi√≥n
        </button>
        <div id="login-modal-msg" class="login-modal-msg"></div>
      </div>

      <!-- Paso 3: Confirmaci√≥n de email enviado -->
      <div id="login-step-3" style="display: none;">
        <h2>Inicio de Sesi√≥n por Email</h2>
        <div style="color: #666; font-size: 14px; line-height: 1.6; text-align: left; margin-top: 20px;">
          <p style="margin-bottom: 12px;">
            ¬°Genial! Te hemos enviado un email
          </p>
          <p style="margin-bottom: 12px;">
            Revisa tu bandeja de entrada <strong id="login-email-confirmation" style="font-weight: bold;"></strong> para encontrar el email y haz clic en el enlace para iniciar sesi√≥n autom√°ticamente. Deber√≠a llegar pronto.
          </p>
          <p style="margin-top: 16px; text-decoration: underline; font-size: 13px;">
            No olvides revisar tu carpeta de spam.
          </p>
        </div>
        <div id="login-resend-msg" class="login-modal-msg" style="margin-top: 16px; display: none;"></div>
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button id="login-resend-email-btn" class="login-modal-google" style="background: #CD844D; flex: 1;">
            Reenviar email
          </button>
          <button id="login-close-after-email" class="login-modal-google" style="background: #6c757d; flex: 1;">
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de instalaci√≥n PWA -->
  <div id="install-modal" class="install-modal hidden">
    <div class="install-modal-content">
      <p>¬øTe gustar√≠a descargar el acceso directo a nuestro cat√°logo?</p>
      <button id="install-accept">S√≠, quiero</button>
      <button id="install-later">En otro momento</button>
    </div>
  </div>

  <!-- Scripts esenciales del cat√°logo - VERSI√ìN SUPABASE -->
  <script type="module" src="scripts/config.js?v=supabase1"></script>
  <script type="module" src="scripts/supabase-client.js?v=supabase1"></script>
  <script type="module" src="scripts/main-supabase.js?v=supabase1"></script>
  <script type="module" src="scripts/auth-status.js?v=modal1"></script>
  <script type="module" src="scripts/product-alternatives.js"></script>
  <script type="module" src="scripts/cart-persistent.js?v=fix1"></script>
  <script type="module" src="scripts/search-manager.js?v=fix1"></script>
  <script type="module" src="scripts/whatsapp.js?v=fix1"></script>
  <script type="module" src="scripts/scroll.js?v=fix1"></script>
  <script src="scripts/pwa-install.js?v=fix1"></script>
  <script src="scripts/filtros.js?v=fix1"></script>
  
  <!-- Modal de producto con SKU -->
  <div id="product-modal" class="product-modal">
    <div class="product-modal-content">
      <button class="product-modal-close" aria-label="Cerrar">√ó</button>
      <div id="product-modal-body"></div>
    </div>
  </div>

  <!-- Scripts opcionales (comentados para evitar conflictos) -->
  <!-- <script type="module" src="scripts/error-handler.js?v=2.0"></script> -->
  <!-- <script type="module" src="scripts/config.js?v=2.0"></script> -->
  <!-- <script type="module" src="scripts/supabase-client.js?v=2.0"></script> -->
  <!-- <script type="module" src="scripts/data-source.js?v=2.0"></script> -->
  <!-- <script type="module" src="scripts/auth-status.js?v=2.0"></script> -->
  <!-- <script type="module" src="scripts/main.js?v=2.0"></script> -->
  <!-- <script type="module" src="scripts/health-check.js?v=2.0"></script> -->
</body>
</html>
