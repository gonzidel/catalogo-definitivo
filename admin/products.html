<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Art√≠culos | Admin</title>
  <link rel="stylesheet" href="../styles.css" />
  <style>
    /* Mejora de UX para creaci√≥n/edici√≥n de productos - Optimizado para 1366x768 */
    body{margin:0;padding:8px;font-size:13px}
    .toolbar{display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin-bottom:6px}
    .toolbar .spacer{flex:1 1 auto}
    .card{border:1px solid #e5e5e5;border-radius:8px;padding:10px;background:#fff;margin-bottom:8px}
    .card legend{padding:0 4px;font-size:13px;font-weight:600}
    .grid{display:grid;gap:8px}
    @media (min-width: 880px){
      .grid.cols-3{grid-template-columns:repeat(3,1fr)}
      .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width: 1366px){
      .grid.cols-3{grid-template-columns:repeat(2,1fr)}
    }
    label{display:flex;flex-direction:column;gap:4px;font-weight:600;font-size:12px}
    input, select, textarea{padding:6px;border:1px solid #ddd;border-radius:6px;font-size:12px}
    input:focus, select:focus, textarea:focus{outline:none;border-color:#7b61ff;box-shadow:0 0 0 2px rgba(123,97,255,.15)}
    small.hint{color:#666;font-size:11px;line-height:1.3}
    /* Tabla de variantes con scroll horizontal */
    .variants-wrapper{overflow-x:auto;width:100%;margin-top:8px}
    #variants-table{width:100%;min-width:1200px;border-collapse:collapse;font-size:12px}
    #variants-table thead th{position:sticky;top:0;background:#fafafa;border-bottom:1px solid #eee;z-index:1;padding:6px 4px;font-size:11px;font-weight:600;white-space:nowrap}
    #variants-table th,#variants-table td{padding:6px 4px;border-bottom:1px solid #f0f0f0;vertical-align:top}
    #variants-table tbody tr:nth-child(odd){background:#fcfcfc}
    #variants-table input[type="text"],#variants-table input[type="number"]{width:100%;box-sizing:border-box;padding:4px;font-size:11px}
    #variants-table textarea{width:100%;box-sizing:border-box;padding:4px;font-size:11px;resize:vertical}
    #variants-table select{width:100%;box-sizing:border-box;padding:4px;font-size:11px}
    .btn{padding:6px 10px;border:1px solid #ddd;border-radius:6px;background:#fff;cursor:pointer;font-size:12px;white-space:nowrap}
    .btn.primary{background:#3a6df0;border-color:#2f5fe0;color:#fff}
    .btn.danger{border-color:#c33;color:#c33;background:#fff}
    .actions{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
    h1{font-size:20px;margin:8px 0}
    /* Ajustes para campos espec√≠ficos */
    #p-search{min-width:200px;font-size:12px;padding:6px}
    #p-results{min-width:200px;font-size:12px;padding:6px}
    /* Tags jer√°rquicos m√°s compactos */
    #tag1-select,#tag2-select,#tag3-select{font-size:11px;padding:5px}
    /* Im√°genes m√°s compactas */
    .v-images-list input{font-size:11px;padding:4px}
    .v-images-list img{width:40px;height:40px}
  </style>
</head>
<body>
  <div class="container" style="max-width:1320px;margin:8px auto;padding:0 8px;">
    <h1>Productos y Variantes</h1>
    <div class="toolbar">
      <a href="./index.html">‚Üê Volver al panel</a>
      <span class="spacer"></span>
      <a href="./products.html" class="btn">Productos</a>
      <a href="./stock.html" class="btn">Stock</a>
      <a href="./orders.html" class="btn">Pedidos</a>
      <a href="./import-export.html" class="btn">Importar/Exportar</a>
    </div>

    <section class="card" style="margin-bottom:8px;">
      <div class="actions" style="gap:8px;flex-wrap:wrap">
        <input id="p-search" placeholder="Buscar por nombre o handle..." style="flex:1;" list="products-datalist"/>
        <button id="p-search-btn" type="button" class="btn">Buscar</button>
        <select id="p-results" style="min-width:260px;"></select>
        <button id="p-load" type="button" class="btn">Cargar</button>
        <button id="p-new" type="button" class="btn primary">Nuevo</button>
      </div>
    </section>

    <form id="product-form">
      <fieldset class="card">
        <legend>Producto</legend>
        <div class="grid cols-3">
          <label>Categor√≠a
            <select id="category">
              <option>Calzado</option>
              <option>Ropa</option>
              <option>Otros</option>
            </select>
          </label>
          <label>Handle (√∫nico)
            <input id="handle" placeholder="zapatilla-343" />
          </label>
          <label>Estado
            <select id="status">
              <option value="active">active</option>
              <option value="draft">draft</option>
            </select>
          </label>
          <label>Nombre
            <input id="name" placeholder="Zapatilla 343" />
          </label>
          <label>Descripci√≥n
            <input id="description" />
          </label>
          <label>Proveedor
            <div style="display:flex;gap:6px;align-items:flex-start;">
              <select id="supplier" style="flex:1;">
                <option value="">Sin proveedor</option>
              </select>
              <button type="button" id="edit-supplier-btn" class="btn" style="white-space:nowrap;display:none;">Editar</button>
              <button type="button" id="new-supplier-btn" class="btn" style="white-space:nowrap;">+ Nuevo</button>
            </div>
            <div id="new-supplier-form" style="display:none;margin-top:6px;padding:8px;border:1px solid #ddd;border-radius:4px;background:#f9f9f9;">
              <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:6px;align-items:end;">
                <div>
                  <label style="font-size:11px;color:#666;display:block;margin-bottom:2px;">Nombre</label>
                  <input type="text" id="new-supplier-name" placeholder="Nombre del proveedor" style="width:100%;padding:4px;border:1px solid #ddd;border-radius:4px;font-size:11px">
                </div>
                <div>
                  <label style="font-size:11px;color:#666;display:block;margin-bottom:2px;">C√≥digo (opcional)</label>
                  <input type="text" id="new-supplier-code" placeholder="C√≥digo" style="width:100%;padding:4px;border:1px solid #ddd;border-radius:4px;font-size:11px">
                </div>
                <div style="display:flex;gap:4px;">
                  <button type="button" id="create-supplier-btn" class="btn primary" style="white-space:nowrap;padding:4px 8px;font-size:11px">Crear</button>
                  <button type="button" id="cancel-supplier-btn" class="btn" style="white-space:nowrap;padding:4px 8px;font-size:11px">Cancelar</button>
                </div>
              </div>
            </div>
            <div id="edit-supplier-form" style="display:none;margin-top:6px;padding:8px;border:1px solid #ddd;border-radius:4px;background:#f9f9f9;">
              <div style="display:grid;grid-template-columns:1fr auto;gap:6px;align-items:end;">
                <div>
                  <label style="font-size:11px;color:#666;display:block;margin-bottom:2px;">C√≥digo del proveedor</label>
                  <input type="text" id="edit-supplier-code" placeholder="C√≥digo" style="width:100%;padding:4px;border:1px solid #ddd;border-radius:4px;font-size:11px">
                </div>
                <div style="display:flex;gap:4px;">
                  <button type="button" id="save-supplier-code-btn" class="btn primary" style="white-space:nowrap;padding:4px 8px;font-size:11px">Guardar</button>
                  <button type="button" id="cancel-edit-supplier-btn" class="btn" style="white-space:nowrap;padding:4px 8px;font-size:11px">Cancelar</button>
                </div>
              </div>
            </div>
          </label>
          <label>Porcentaje de ganancia (%)
            <input id="price-percentage" type="number" step="0.1" min="0" max="100" value="30" placeholder="30" />
            <small class="hint">Porcentaje que se aplica al costo para calcular el precio recomendado</small>
          </label>
          <label>Monto log√≠stico ($)
            <input id="logistic-amount" type="text" inputmode="numeric" value="500" placeholder="500" />
            <small class="hint">Monto fijo que se suma al costo y porcentaje</small>
          </label>
          <label style="grid-column: 1 / -1;">Tags Jer√°rquicos
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;margin-top:6px;">
              <div>
                <label style="font-size:11px;color:#666;margin-bottom:2px;">Tags1 (Nivel 1)</label>
                <select id="tag1-select" style="width:100%;padding:5px;font-size:11px">
                  <option value="">-- Seleccionar Tags1 --</option>
                </select>
                <input type="text" id="tag1-new" placeholder="O crear nuevo..." style="width:100%;margin-top:3px;display:none;padding:4px;font-size:11px" />
                <button type="button" id="tag1-create" class="btn" style="margin-top:3px;display:none;width:100%;padding:4px 8px;font-size:11px">Crear Tags1</button>
              </div>
              <div>
                <label style="font-size:11px;color:#666;margin-bottom:2px;">Tags2 (Nivel 2)</label>
                <select id="tag2-select" style="width:100%;padding:5px;font-size:11px" disabled>
                  <option value="">-- Primero selecciona Tags1 --</option>
                </select>
                <input type="text" id="tag2-new" placeholder="O crear nuevo..." style="width:100%;margin-top:3px;display:none;padding:4px;font-size:11px" />
                <button type="button" id="tag2-create" class="btn" style="margin-top:3px;display:none;width:100%;padding:4px 8px;font-size:11px">Crear Tags2</button>
              </div>
              <div>
                <label style="font-size:11px;color:#666;margin-bottom:2px;">Tags3 (Nivel 3) - M√°x 2</label>
                <select id="tag3-select" style="width:100%;padding:5px;font-size:11px" disabled multiple>
                  <option value="">-- Primero selecciona Tags2 --</option>
                </select>
                <input type="text" id="tag3-new" placeholder="O crear nuevo..." style="width:100%;margin-top:3px;display:none;padding:4px;font-size:11px" />
                <button type="button" id="tag3-create" class="btn" style="margin-top:3px;display:none;width:100%;padding:4px 8px;font-size:11px">Crear Tags3</button>
                <div id="tag3-chips" style="display:flex;gap:4px;flex-wrap:wrap;margin-top:4px;"></div>
              </div>
            </div>
            <small class="hint">Seleccion√° Tags1, luego Tags2, y finalmente hasta 2 Tags3. Los Tags3 se pueden compartir entre diferentes Tags2 del mismo Tags1.</small>
          </label>
          <div style="margin-top:8px;padding:8px;background:#f0f7ff;border:1px solid #3a6df0;border-radius:4px;">
            <button type="button" id="auto-tags-btn" class="btn primary" style="width:100%;padding:8px;font-size:12px;">
              ü§ñ Auto-tags con IA
            </button>
            <span id="auto-tags-status" style="display:block;margin-top:6px;font-size:11px;color:#666;"></span>
          </div>
        </div>
      </fieldset>

      <fieldset class="card" style="margin-top:8px;">
        <legend>Detalles y Destacados (Tags3)</legend>
        
        <!-- Secci√≥n Details -->
        <div style="margin-bottom:16px;">
          <label style="font-weight:600;font-size:12px;display:block;margin-bottom:6px;">
            Detalles (para similitud) - Ilimitados
          </label>
          <div style="display:flex;gap:8px;margin-bottom:8px;">
            <input 
              type="text" 
              id="details-search" 
              placeholder="Buscar detalles..." 
              style="flex:1;padding:6px;font-size:12px;border:1px solid #ddd;border-radius:4px;"
            />
          </div>
          <div 
            id="details-list" 
            style="max-height:200px;overflow-y:auto;border:1px solid #ddd;border-radius:4px;padding:8px;background:#fafafa;"
          >
            <div style="color:#666;font-size:11px;text-align:center;padding:8px;">
              Selecciona Tags1 y Tags2 para ver detalles disponibles
            </div>
          </div>
          <small class="hint" style="display:block;margin-top:4px;">
            Estos detalles se usan para calcular similitud entre productos. Puedes seleccionar todos los que apliquen.
          </small>
        </div>

        <!-- Secci√≥n Highlights -->
        <div>
          <label style="font-weight:600;font-size:12px;display:block;margin-bottom:6px;">
            Destacados (m√°x 2) - Se muestran en el cat√°logo
          </label>
          <div 
            id="highlights-container" 
            style="display:flex;gap:6px;flex-wrap:wrap;min-height:40px;padding:8px;border:1px solid #ddd;border-radius:4px;background:#f9f9f9;"
          >
            <div style="color:#666;font-size:11px;text-align:center;width:100%;padding:4px;">
              Selecciona hasta 2 detalles de los seleccionados arriba
            </div>
          </div>
          <small class="hint" style="display:block;margin-top:4px;">
            Solo puedes destacar detalles que ya est√©n seleccionados en "Detalles". M√°ximo 2.
          </small>
        </div>

        <div style="margin-top:12px;">
          <button type="button" id="save-details-highlights-btn" class="btn primary">
            Guardar Detalles y Destacados
          </button>
          <span id="details-highlights-status" style="margin-left:8px;font-size:11px;"></span>
        </div>
      </fieldset>

      <fieldset class="card" style="margin-top:8px;">
        <legend>Variantes</legend>
        <div class="actions" style="margin-bottom:6px;justify-content:space-between;flex-wrap:wrap">
          <div class="actions" style="gap:6px">
            <button type="button" id="add-variant" class="btn primary">+ Agregar variante</button>
            <small class="hint">Pod√©s editar talles y stock en bloque o en modo simple.</small>
          </div>
          <small class="hint">Im√°genes: peg√° URLs. Ten√©s 3 por defecto y pod√©s agregar m√°s.</small>
        </div>
        <div class="variants-wrapper">
          <table id="variants-table">
            <thead>
              <tr>
                <th style="min-width:100px">Color</th>
                <th style="min-width:180px">Talles y Stock</th>
                <th style="min-width:120px">SKU base</th>
                <th style="min-width:90px">Costo</th>
                <th style="min-width:120px">Precio recomendado</th>
                <th style="min-width:100px">Stock (modo simple)</th>
                <th style="min-width:60px">Activa</th>
                <th style="min-width:200px">Im√°genes (URLs)</th>
                <th style="min-width:30px"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </fieldset>

      <div class="actions" style="margin-top:8px">
        <button type="submit" class="btn primary">Guardar producto</button>
        <span class="spacer"></span>
        <button type="button" id="p-delete" class="btn danger">Eliminar producto</button>
        <span id="save-status"></span>
      </div>
    </form>
  </div>

  <script src="./suppress-extension-errors.js"></script>
  <script type="module" src="../scripts/config.js"></script>
  <script type="module" src="../scripts/supabase-client.js"></script>
  <script type="module" src="./products.js"></script>
  <datalist id="colors-datalist"></datalist>
  <datalist id="products-datalist"></datalist>
</body>
</html>
